
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>厨余称重秤</title>

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="assets/font-awesome/4.5.0/css/iconfont.css" />

    <!-- page specific plugin styles -->

    <!-- text fonts -->
    <link rel="stylesheet" href="assets/css/fonts.googleapis.com.css" />

    <!-- ace styles -->
    <link rel="stylesheet" href="assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
    <![endif]-->
    <link rel="stylesheet" href="assets/css/ace-skins.min.css" />
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css" />

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
    <![endif]-->

    <link rel="stylesheet" href="static/css/base.css" />
    <link rel="stylesheet" href="static/css/city_index.css" />
    <!-- inline styles related to this page -->

    <!-- ace settings handler -->
    <script src="assets/js/ace-extra.min.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

    <!--[if lte IE 8]>
    <script src="assets/js/html5shiv.min.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

</head>

<body class="skin-1">
<!--no-skin默认theme skin-1黑色-->
<!--顶部logo、user信息-->
<div id="navbar" class="navbar navbar-default ace-save-state">
    <div class="navbar-container ace-save-state logo_cintainer" id="navbar-container">
        <!--logo-->
        <div class="navbar-header pull-left logo">
            <a href="javascript:;">
                <img src="static/img/logo.png" alt="好嘞分类">
            </a>
        </div>

        <div class="navbar-header pull-left">
            <ul class="navbar-navList">
                <li><a href="area_list.html?text=area_list">分类单位管理</a></li>
                <li class='nav-list-active'><a href="device_management.html?text=device_management">分类设备管理</a></li>
                <li><a href="score_rule.html?text=score_rule">积分现金管理</a></li>
                <li><a href="user_management.html?text=user_management">报表管理</a></li>
                <li><a href="institution_management.html?text=institution_management">系统管理</a></li>
            </ul>
        </div>
        <!--logo-->

        <!--右侧管理员登录-->
        <div class="navbar-buttons navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">
                <li class="light-blue dropdown-modal">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle" style="background: #fbfbfb">
                        <!--   <img id="user_avatar" class="nav-user-photo" src="static/img/favicon.png" alt="Jason's Photo" /> -->
                        <span id="username" class="user-info">

                            </span>

                        <i class="ace-icon fa fa-caret-down"></i>
                    </a>

                    <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <!--<li>
                            <a href="#">
                                <i class="ace-icon fa fa-user"></i>
                                修改密码
                            </a>
                        </li>-->

                        <!--<li class="divider"></li>-->
                        <li id="sigin_out">
                            <a href="#">
                                <i class="ace-icon fa fa-power-off"></i>
                                注销用户
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <!--右侧管理员登录-->
    </div>
    <!-- /.navbar-container -->
</div>
<!--顶部logo、user信息-->

<!--内容区-->
<div class="main-container ace-save-state" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.loadState('main-container')
        } catch (e) {}
    </script>

    <!--左侧导航-->
    <div id="sidebar" class="sidebar responsive ace-save-state JS-nav">
        <script type="text/javascript">
            try {
                ace.settings.loadState('sidebar')
            } catch (e) {}
        </script>

        <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
            <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state" data-icon1="ace-icon fa fa-angle-double-left"
               data-icon2="ace-icon fa fa-angle-double-right"></i>
        </div>
    </div>
    <!--左侧导航-->

    <!--右侧内容区-->
    <div class="main-content">
        <div class="main-content-inner">
            <div class="breadcrumbs ace-save-state" id="breadcrumbs">
                <!-- 面包屑导航 -->
                <ul class="breadcrumb">
                    <li>厨余称重秤</li>
                </ul>
            </div>
            <div class="page-content style_adjustment">
                <div class="row style_adjustment">
                    <!--条件查询-->
                    <div class="order-box">
                        <form class="form-inline">
                            <div class="clearfix row">
                                <div class="pull-left col-xs-12 col-sm-3">
                                    <label>全部机构：</label>
                                    <select class="form-control search-input w-150 institution_list" id="institution">
                                    </select>
                                </div>
                                <div class="pull-left col-xs-12 col-sm-3">
                                    <label>箱体编号：</label>
                                    <input placeholder="请输入箱体编号" type="text" class="form-control w-150 search-input" id="box_number">
                                </div>
                                <div class="pull-left col-xs-12 col-sm-3">
                                    <label style="width:100px;">终端设备号：</label>
                                    <input placeholder="请输入终端设备号" type="text" class="form-control w-150 search-input" id="ter_number">
                                </div>

                            </div>
                            <div class="clearfix row" style="margin-top: 10px">
                                <div class="pull-left col-xs-12  col-sm-3">
                                    <label>
                                        省：
                                    </label>
                                    <select id="province" class="form-control search-input w-150">
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                <div class="pull-left col-xs-12 col-sm-3">
                                    <label>
                                        市：
                                    </label>
                                    <select class="form-control search-input w-150" id="city">
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                <div class="pull-left col-xs-12  col-sm-3">
                                    <label style="width:100px;">
                                        县：
                                    </label>
                                    <select class="form-control search-input w-150" id="county">
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                <div class="pull-right">
                                    <button id="search" type="button" class="btn btn-success btn-xs" style="margin-right: 5px">
                                        <i class="ace-icon fa fa-search bigger-110"></i>
                                        搜索
                                    </button>

                                </div>
                            </div>
                            <div class="clearfix row" style="margin-top:20px;margin-left:10px;">
                                <a href="javascript:;" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#createAreaModal">
                                    <i class="ace-icon fa fa-plus bigger-110"></i>
                                    添加设备
                                </a>
                                <a href="javascript:;" class="btn btn-xs btn-primary"  data-toggle="modal" data-target="#outAreaModal">
                                    <i class="ace-icon fa fa-share bigger-110"></i>
                                   导出
                                </a>
                            </div>
                        </form>

                    </div>
                    <!--条件查询结束-->
                    <!-- 表格 -->
                    <div class="table-box">
                        <table id="table" class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <th class="center">序号</th>
                                <th class="center">所属机构</th>
                                <th class="center">箱体编号</th>
                                <th class="center">终端设备号</th>
                                <th class="center">供应商</th>
                                <th class="center">小区名称</th>
                                <th class="center">操作</th>
                            </tr>
                            </thead>
                            <tbody id="s_list">



                            </tbody>
                        </table>
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
                <!--分页开始-->
                <div class="row" id="page_conten" code="1">
                    <ul class="pagination pull-right">
                        <li _class="disabled" id="prev">
                            <a href="javascript:;">
                                <i class="ace-icon fa fa-angle-double-left"></i>
                            </a>
                        </li>
                        <div id="page">

                        </div>
                        <li id="next">
                            <a href="javascript:;">
                                <i class="ace-icon fa fa-angle-double-right"></i>
                            </a>
                        </li>
                        <li>
                            <input class="gonumber" placeholder="跳转" style="padding-left: 10px;width:60px;height:32px;margin-left: 10px;" type="number" name="" id="" value="" />
                            <button id="go">go</button>
                        </li>
                    </ul>
                </div>
                <!--分页结束-->
            </div>
            <!-- /.page-content -->
        </div>
    </div>
    <!--右侧内容区-->

    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
    </a>
</div>

<div id="loading" style="width: 100%; height: 100%; background: rgba(0,0,0, .6); position: fixed; top: 0; left: 0; z-index: 999;">
    <i class="ace-icon fa fa-spinner fa-spin orange bigger-125" style="position: absolute; top: 300px; font-size: 100px !important; width: 100%;"></i>
</div>


<!-- 添加设备 -->
<div class="modal fade bs-example-modal-lg" id="createAreaModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">添加设备</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="recipient-name" class="col-sm-2 control-label">*选择机构:</label>
                        <div class="col-sm-10">
                            <select class="form-control institution_list mechanism_id" id="add_institution">

                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-sm-2 control-label">*选择供应商:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="add_supplier_id">
                                <option value="">请选择</option>
                                <option value="1">集团</option>
                                <option value="2">联运</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="recipient-name" class="col-sm-2 control-label">*选择小区:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="add_area_id">
                                <option value="">请选择</option>
                                <option value="1">桑德1</option>
                                <option value="2">桑德2</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">*箱体编号:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" placeholder="" id="add_box_number">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">*终端设备号:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" placeholder="" id="add_ter_number">
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="add_save_btn">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑设备 -->
<div class="modal fade bs-example-modal-lg" id="editAreaModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">编辑设备</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="recipient-name" class="col-sm-2 control-label">*选择机构:</label>
                        <div class="col-sm-10">
                            <select class="form-control institution_list mechanism_id" id="edit_institution">

                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-sm-2 control-label">*选择供应商:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="edit_supplier_id">
                                <option value="0">请选择</option>
                                <option value="1">集团</option>
                                <option value="2">联运</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-sm-2 control-label">*选择小区:</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="edit_area_id">
                                <option value="">请选择</option>
                                <option value="1">桑德1</option>
                                <option value="2">桑德2</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">*箱体编号:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" placeholder="" id="edit_box_number">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-2 control-label">*终端设备号:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" placeholder="" id="edit_ter_number">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="edit_save_btn">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- basic scripts -->
<!--[if !IE]> -->
<script src="assets/js/jquery-2.1.4.min.js"></script>
<!-- <![endif]-->

<!--[if IE]>
<script src="assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write(
        "<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="assets/js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->

<!--[if lte IE 8]>
<script src="assets/js/excanvas.min.js"></script>
<![endif]-->
<script src="assets/js/jquery-ui.custom.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/jquery.easypiechart.min.js"></script>
<script src="assets/js/jquery.sparkline.index.min.js"></script>
<script src="assets/js/jquery.flot.min.js"></script>
<script src="assets/js/jquery.flot.pie.min.js"></script>
<script src="assets/js/jquery.flot.resize.min.js"></script>

<!-- ace scripts -->
<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>

<!-- inline scripts related to this page -->
<script src="static/js/toast/toast.js"></script>
<script src="static/js/md5.js"></script>
<script src="static/js/utils.js"></script>
<script src="static/js/cookies.js"></script>
<script src="static/js/nav.js"></script>
<script type="text/javascript">
    $(function(){
        //请求开关
        var bOK = true;
        var page;
        var cade;
        //搜索条件
        var searchObj = {
            box_number:'', //箱体编号
            ter_number:'', //终端设备号
            mechanism_id:'', //机构id
            province_id:'',
            city_id:'',
            county_id:'',
            service_sub:'', //服务主体
            page: cade
        };
        var pageFn = {
            init: function(){
                $('#username').text(getCookie('username'));
                pageFn.createNav();
                pageFn.getList(searchObj);
                //分页
                pageFn.pageList(page,cade);
                //获取省
                pageFn.getProvince();
                pageFn.search();
                //初始化添加设备保存按钮
                pageFn.addSaveFn();
                //初始化编辑设备保存按钮
                pageFn.editSaveFn();
                //获取机构列表
                pageFn.getInstitutionList();
                //退出登录
                pageFn.logOut();
                //初始化服务主体选中事件
                pageFn.serviceSubChange();
            },
            getList: function(searchObj){
                request({
                    url: '/api/equipment/getList',
                    data: searchObj
                }, function(data) {
                    console.log(data);
                    if(!bOK){
                        $('#loading').show();
                    }
                    if(data.code == 0){
                        var res = data.data.list;
                        //创建列表
                        var shtml = '';

                        if(res.length > 0){
                            cade = data.data.current_page;
                            page = Math.ceil(data.data.total/20);
                            pageFn.pageList(page,cade);

                            $.each(res, function(index, item){
                                shtml += pageFn.createList(item,index);
                            })

                            $("#page_conten").show();
                            //点击分页
                            pageFn.pageClick();
                        }else{
                            shtml += '<tr><td colspan="'+ $("#table tr th").length +'">暂无数据。</td></tr>';
                            $("#page_conten").hide();
                        }

                        setTimeout(function(){
                            $('#s_list').html(shtml);
                            bOK = true;
                            $('#loading').hide();
                        }, 1000)
                    }else{
                        toast(data.msg).then(function(){
                            $('#loading').hide();
                        });
                    }
                })
            },
            //根据服务主体获取服务内容
            getServiceData: function(service_sub,mechanism_id){
                if(!mechanism_id) return toast('请先选择机构!');

                request({
                    url: '/api/equipment/getServiceList',
                    data: {
                        type:service_sub, // 服务主体类型 0 小区 1 学校 2 企业 3其他
                        mechanism_id:mechanism_id // 机构id
                    }
                }, function(data) {
                    console.log(data)
                    if(data.code == 0){
                        var res = data.data;
                        var shtml = '<option value="">请选择</option>';

                        if(res.length > 0){
                            $.each(res,function(index,item){
                                shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                            });
                        }
                        $('.service_sub_id').html(shtml);
                    }
                })
            },
            //服务主体选中事件
            serviceSubChange: function(){
                $('input[name=add_service_sub]').change(function(){
                    var val = $(this).val();
                    var mechanism_id = $('#add_institution').val();
                    //根据服务主体获取服务内容
                    pageFn.getServiceData(val,mechanism_id);
                });
                $('input[name=edit_service_sub]').change(function(){
                    var val = $(this).val();
                    var mechanism_id = $('#edit_institution').val();
                    //根据服务主体获取服务内容
                    pageFn.getServiceData(val,mechanism_id);
                });
                $('#add_institution').change(function(){
                    var val = $('input[name=add_service_sub]:checked').val();
                    var mechanism_id = $(this).val();
                    //根据服务主体获取服务内容
                    pageFn.getServiceData(val,mechanism_id);
                });
                $('#edit_institution').change(function(){
                    var val = $('input[name=edit_service_sub]:checked').val();
                    var mechanism_id = $(this).val();
                    //根据服务主体获取服务内容
                    pageFn.getServiceData(val,mechanism_id);
                })
            },
            createNav: function () {
                var nav_container = $(".JS-nav")[0];
                this.nav = new Nav(nav_container);
            },
            getProvince: function(){
                request({
                    url: '/api/houses/getProvince',
                    data: {}
                }, function(res) {
                    if(res.code == 0){
                        var shtml = '<option value="">请选择</option>';
                        $.each(res.data, function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $('#province').html(shtml);
                        $('#add_province,#edit_province').html(shtml);

                        $('#province').change(function(){
                            var pid = $(this).val();
                            $('#city').html('<option value="">请选择</option>');
                            $('#county').html('<option value="">请选择</option>');
                            pageFn.getCity(pid);
                        });

                        $('#add_province').change(function(){
                            var pid = $(this).val();
                            $('#add_city').html('<option value="">请选择</option>');
                            $('#add_county').html('<option value="">请选择</option>');
                            pageFn.getCityAdd(pid);
                        });

                        $('#edit_province').change(function(){
                            var pid = $(this).val();
                            $('#edit_city').html('<option value="">请选择</option>');
                            $('#edit_county').html('<option value="">请选择</option>');
                            pageFn.getCityEdit(pid);
                        });
                    }else{
                        toast(res.msg);
                    }
                })
            },
            getCity: function(pid){
                if(!pid) return;
                request({
                    url: '/api/houses/getCity',
                    data: {
                        pid: pid
                    }
                }, function(res) {
                    if(res.code == 0){
                        var shtml = '<option value="">请选择</option>';
                        $.each(res.data, function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $('#city').html(shtml);

                        $('#city').change(function(){
                            var cid = $(this).val();
                            pageFn.getCounty(cid);
                        });
                    }else{
                        toast(res.msg);
                    }
                })
            },
            //添加设备获取城市
            getCityAdd: function(pid){
                if(!pid) return;
                request({
                    url: '/api/houses/getCity',
                    data: {
                        pid: pid
                    }
                }, function(res) {
                    if(res.code == 0){
                        var shtml = '<option value="">请选择</option>';
                        $.each(res.data, function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $('#add_city').html(shtml);

                        $('#add_city').change(function(){
                            var cid = $(this).val();
                            pageFn.getCountyAdd(cid);
                        })
                    }else{
                        toast(res.msg);
                    }
                })
            },
            //编辑设备获取城市
            getCityEdit: function(pid){
                if(!pid) return;
                request({
                    url: '/api/houses/getCity',
                    data: {
                        pid: pid
                    }
                }, function(res) {
                    if(res.code == 0){
                        var shtml = '<option value="">请选择</option>';
                        $.each(res.data, function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $('#edit_city').html(shtml);

                        $('#edit_city').change(function(){
                            var cid = $(this).val();
                            pageFn.getCountyEdit(cid);
                        })
                    }else{
                        toast(res.msg);
                    }
                })
            },
            getCounty: function(cid){
                if(!cid) return;
                request({
                    url: '/api/houses/getCounty',
                    data: {
                        cid: cid
                    }
                }, function(res) {
                    if(res.code == 0){
                        var shtml = '<option value="">请选择</option>';
                        $.each(res.data, function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $('#county').html(shtml);
                    }else{
                        toast(res.msg);
                    }
                })
            },
            //添加设备获取区县
            getCountyAdd: function(cid){
                if(!cid) return;
                request({
                    url: '/api/houses/getCounty',
                    data: {
                        cid: cid
                    }
                }, function(res) {
                    if(res.code == 0){
                        var shtml = '<option value="">请选择</option>';
                        $.each(res.data, function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $('#add_county').html(shtml);
                    }else{
                        toast(res.msg);
                    }
                })
            },
            //编辑设备获取区县
            getCountyEdit: function(cid){
                if(!cid) return;
                request({
                    url: '/api/houses/getCounty',
                    data: {
                        cid: cid
                    }
                }, function(res) {
                    if(res.code == 0){
                        var shtml = '<option value="">请选择</option>';
                        $.each(res.data, function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $('#edit_county').html(shtml);
                    }else{
                        toast(res.msg);
                    }
                })
            },
            search: function(){
                $('#search').click(function(){
                    var box_number = $('#box_number').val();
                    var ter_number = $('#ter_number').val();
                    var mechanism_id = $('#institution').val();
                    var province_id = $('#province').val();
                    var city_id = $('#city').val();
                    var county_id = $('#county').val();
                    var service_sub = $('#service_sub').val();

                    searchObj = {
                        box_number:box_number, //箱体编号
                        ter_number:ter_number, //终端设备号
                        mechanism_id:mechanism_id, //机构id
                        province_id:province_id,
                        city_id:city_id,
                        county_id:county_id,
                        service_sub:service_sub, //服务主体
                        page: cade
                    };

                    pageFn.getList(searchObj);
                })
            },
            //获取机构列表
            getInstitutionList: function(){
                request({
                    url: '/api/mechanism/getList',
                    data: {}
                }, function(res) {
                    console.log(res);
                    if(res.code == 0){
                        var list = res.data.list;

                        var shtml = '<option value="">请选择</option>';
                        var ahtml = '<option value="">请选择</option>';
                        $.each(list,function(index,item){
                            shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                        });
                        $.each(list,function(index,item){
                            if(item.status == 1){
                                ahtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
                            }
                        });
                        $('#institution').html(shtml);
                        $('#add_institution,#edit_institution').html(ahtml);
                    }else{
                        toast(res.msg);
                    }
                })
            },
            //添加设备保存按钮
            addSaveFn: function(){
                $('#add_save_btn').click(function(){
                    var add_institution_id = $('#add_institution').val();
                    var add_supplier_id = $('#add_supplier_id').val();
                    var add_box_number = $('#add_box_number').val();
                    var add_ter_number = $('#add_ter_number').val();
                    var add_province_id = $('#add_province').val();
                    var add_city_id = $('#add_city').val();
                    var add_county_id = $('#add_county').val();
                    var add_service_sub = $('input[name=add_service_sub]:checked').val();
                    var add_service_sub_id = $('#add_service_sub_id').val();

                    if(!add_institution_id) return toast('请选择机构');
                    if(!add_supplier_id) return toast('请选择供应商');
                    if(!add_box_number) return toast('请填写箱体编号');
                    if(!add_ter_number) return toast('请填写终端设备号');
                    if(!add_province_id) return toast('请选择省');
                    if(!add_city_id) return toast('请选择市');
                    if(!add_county_id) return toast('请选择区县');
                    //if(!add_service_sub_id) return toast('请选择服务内容');

                    var tempObj = {
                        mechanism_id:add_institution_id,
                        box_number:add_box_number,
                        ter_number:add_ter_number,
                        supplier_id:add_supplier_id,
                        province_id:add_province_id,
                        city_id:add_city_id,
                        county_id:add_county_id,
                        service_sub:add_service_sub,
                        service_sub_id:add_service_sub_id
                    };

                    request({
                        url: '/api/equipment/add',
                        data: tempObj
                    }, function(data) {
                        console.log(data);
                        if(data.code == 0){
                            toast('添加成功！').then(function(){
                                searchObj = {
                                    box_number:'', //箱体编号
                                    ter_number:'', //终端设备号
                                    mechanism_id:'', //机构id
                                    province_id:'',
                                    city_id:'',
                                    county_id:'',
                                    service_sub:'', //服务主体
                                    page: cade
                                };
                                pageFn.getList(searchObj);

                                $('#createAreaModal').modal('hide');
                            })
                        }else{
                            toast(data.msg);
                        }
                    })

                })
            },
            //编辑设备保存
            editSaveFn: function(){
                var _id = null;
                $('#s_list').on('click','.modify', function(){
                    $('#editAreaModal').modal('show');

                    _id = $(this).data().id;

                    request({
                        url: '/api/equipment/info',
                        data: {
                            id:_id,
                            action:'edit'
                        }
                    }, function(data) {
                        console.log(data);
                        if(data.code == 0){
                            if(!data.data.infodata || data.data.infodata.length <= 0 ) return;
                            var info = data.data.infodata[0];
                            $('#edit_institution').val(info.mechanism_id);
                            $('#edit_supplier_id').val(info.supplier_id);
                            $('#edit_box_number').val(info.box_number);
                            $('#edit_ter_number').val(info.ter_number);
                            $('#edit_province').val(info.province_id);
                            //服务主体 0小区 1学校 2企业 3其他
                            var service_sub = info.service_sub;

                            if(service_sub == 0){
                                $('input[name="edit_service_sub"]').eq(0).prop('checked','checked');
                            }else if(service_sub == 1){
                                $('input[name="edit_service_sub"]').eq(1).prop('checked','checked');
                            }else if(service_sub == 2){
                                $('input[name="edit_service_sub"]').eq(2).prop('checked','checked');
                            }else if(service_sub == 3){
                                $('input[name="edit_service_sub"]').eq(3).prop('checked','checked');
                            }
                            //获取城市数据
                            pageFn.getCityEdit(info.province_id);
                            //获取区县数据
                            pageFn.getCountyEdit(info.city_id);
                            //根据服务主体获取服务内容
                            pageFn.getServiceData(info.service_sub,info.mechanism_id);
                            setTimeout(function(){
                                $('#edit_city').val(info.city_id);
                                $('#edit_county').val(info.county_id);
                                $('#edit_service_sub_id').val(info.service_sub_id);
                            },300)
                        }else{
                            toast(data.msg);
                        }
                    })

                });

                //保存按钮
                $('#edit_save_btn').click(function(){
                    var edit_institution_id = $('#edit_institution').val();
                    var edit_supplier_id = $('#edit_supplier_id').val();
                    var edit_box_number = $('#edit_box_number').val();
                    var edit_ter_number = $('#edit_ter_number').val();
                    var edit_province_id = $('#edit_province').val();
                    var edit_city_id = $('#edit_city').val();
                    var edit_county_id = $('#edit_county').val();
                    var edit_service_sub = $('input[name=edit_service_sub]:checked').val();
                    var edit_service_sub_id = $('#edit_service_sub_id').val();

                    if(!edit_institution_id) return toast('请选择机构');
                    if(!edit_supplier_id) return toast('请选择供应商');
                    if(!edit_box_number) return toast('请填写箱体编号');
                    if(!edit_ter_number) return toast('请填写终端设备号');
                    if(!edit_province_id) return toast('请选择省');
                    if(!edit_city_id) return toast('请选择市');
                    if(!edit_county_id) return toast('请选择区县');
                    //if(!edit_service_sub_id) return toast('请选择服务内容');

                    var tempObj = {
                        id:_id,
                        mechanism_id:edit_institution_id,
                        box_number:edit_box_number,
                        ter_number:edit_ter_number,
                        supplier_id:edit_supplier_id,
                        province_id:edit_province_id,
                        city_id:edit_city_id,
                        county_id:edit_county_id,
                        service_sub:edit_service_sub,
                        service_sub_id:edit_service_sub_id
                    };

                    request({
                        url: '/api/equipment/edit',
                        data: tempObj
                    }, function(data) {
                        console.log(data);
                        if(data.code == 0){
                            toast('修改成功！').then(function(){
                                searchObj = {
                                    box_number:'', //箱体编号
                                    ter_number:'', //终端设备号
                                    mechanism_id:'', //机构id
                                    province_id:'',
                                    city_id:'',
                                    county_id:'',
                                    service_sub:'', //服务主体
                                    page: cade
                                };
                                pageFn.getList(searchObj);

                                $('#editAreaModal').modal('hide');
                            })
                        }else{
                            toast(data.msg);
                        }
                    })
                })
            },
            //创建dom
            createList: function(item,index){
                var shtml = '';
                var _index = (cade-1)*20 + (index+1);

                shtml += '<tr>';
                shtml += '										<td class="center">'+ _index +'</td>';
                shtml += '										<td class="center">'+ item.m_name +'</td>';
                shtml += '										<td class="center">'+ item.box_number +'</td>';
                shtml += '										<td class="center">'+ item.ter_number +'</td>';
                shtml += '										<td class="center">'+ item.s_name +'</td>';
                shtml += '										<td class="center">'+ (item.province_name+item.city_name+item.county_name) +'</td>';

                var service_sub_name = '';

                if(item.service_sub == 0){
                    service_sub_name = '小区';
                }else if(item.service_sub == 1){
                    service_sub_name = '学校';
                }else if(item.service_sub == 2){
                    service_sub_name = '企业';
                }else if(item.service_sub == 3){
                    service_sub_name = '其他';
                }

                shtml += '										<td class="center">';
                shtml += '											<button class=\'modify btn btn-xs btn-info\' data-id="'+ item.id +'">';
                shtml += '												<i class="ace-icon fa fa-pencil bigger-120"></i>';
                shtml += '												编辑';
                shtml += '											</button>';
                shtml += '										</td>';
                shtml += '									</tr>';

                return shtml;
            },
            //获取页码
            pageList:function(page,cade){
                var scade = cade-3;
                if(scade<0){
                    scade=0;
                }
                var spage = page-5;
                var page_cade = page -cade;
                var shtml = '';
                if(page_cade<5){
                    if(page>5){
                        page = 5;
                    }else{
                        spage = 0;
                    }
                    for(var i = 0;i<page;i++){
                        spage = spage+1;
                        shtml += '<li>';
                        shtml += '	<a name="'+spage+'" href="javascript:;">'+spage+'</a>';
                        shtml += '</li>';
                    }
                }else{
                    var pageend = page-1
                    for(var i = 0;i<3;i++){
                        scade = scade+1;
                        shtml += '<li>';
                        shtml += '	<a name="'+scade+'" href="javascript:;">'+scade+'</a>';
                        shtml += '</li>';
                    }
                    shtml += '<li>';
                    shtml += '	<i class="pagedian" href="#">....</i>';
                    shtml += '</li>';
                    shtml += '<li>';
                    shtml += '	<a name="'+pageend+'" href="javascript:;">'+pageend+'</a>';
                    shtml += '</li>';
                    shtml += '<li>';
                    shtml += '	<a name="'+page+'" href="javascript:;">'+page+'</a>';
                    shtml += '</li>';
                }
                $("#page").html(shtml);
                $("#page_conten").attr("code",cade);
                $("#page li a").removeClass("redapge");
                for(var i = 0;i<$("#page li a").length;i++){
                    var id = $("#page li a").eq(i).html();
                    if(id == cade){
                        $("#page li a").eq(i).addClass("redapge");
                    }
                }
            },
            //点击页码
            pageClick:function(){
                $("#page").off().on("click","li",function(){
                    var _this = $(this).children("a");
                    cade = _this.html();
                    $("#page_conten").attr("code",cade);
                    searchObj.page = cade;
                    pageFn.getList(searchObj);
                });
                $("#prev").off().on("click",function(){
                    cade = $("#page_conten").attr("code")-1;
                    if(cade>0){
                        searchObj.page =cade;
                        pageFn.getList(searchObj);
                    }
                });
                $("#next").off().on("click",function(){
                    cade = parseInt($("#page_conten").attr("code"))+1;
                    console.log(cade);
                    if(cade<=page){
                        searchObj.page =cade;
                        pageFn.getList(searchObj);
                    }
                });
                $("#go").off().on("click",function(){
                    cade = $(".gonumber").val();
                    if(cade<=page){
                        searchObj.page =cade;
                        pageFn.getList(searchObj);
                    }
                })
            },
            logOut: function(){
                $('#sigin_out').click(function(){
                    request({
                        url: '/api/user/log-off',
                        data: {}
                    }, function(res) {
                        deleteCookie('token');
                        toast('注销成功').then(function(){
                            location.href = 'login.html';
                        })
                    })
                })
            }
        };

        pageFn.init();

    })
</script>
</body>

</html>