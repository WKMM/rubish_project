
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>小区列表</title>
    <!--ico-->
    <!-- <link rel="icon" type="image/x-icon" href="static/img/favicon.ico"/> -->

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="assets/font-awesome/4.5.0/css/iconfont.css" />

    <!-- page specific plugin styles -->

    <!-- text fonts -->
    <link rel="stylesheet" href="assets/css/fonts.googleapis.com.css" />

    <!-- ace styles -->
    <link rel="stylesheet" href="assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

    <!--[if lte IE 9]>
			<link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
		<![endif]-->
    <link rel="stylesheet" href="assets/css/ace-skins.min.css" />
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css" />

    <!--[if lte IE 9]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

    <link rel="stylesheet" href="static/css/base.css" />
    <link rel="stylesheet" href="static/css/city_index.css" />
    <!-- inline styles related to this page -->

    <!-- ace settings handler -->
    <script src="assets/js/ace-extra.min.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

    <!--[if lte IE 8]>
		<script src="assets/js/html5shiv.min.js"></script>
		<script src="assets/js/respond.min.js"></script>
		<![endif]-->

</head>

<body class="skin-1">
    <!--no-skin默认theme skin-1黑色-->
    <!--顶部logo、user信息-->
    <div id="navbar" class="navbar navbar-default ace-save-state">
        <div class="navbar-container ace-save-state logo_cintainer" id="navbar-container">
            <!--logo-->
            <div class="navbar-header pull-left logo">
                <a href="javascript:;">
                    <img src="static/img/logo.png" alt="好嘞分类">
                </a>
            </div>

            <div class="navbar-header pull-left">
                <ul class="navbar-navList">
	                <li class='nav-list-active'><a href="area_list.html?text=area_list">分类单位管理</a></li>
	                <li><a href="device_management.html?text=device_management">分类设备管理</a></li>
	                <li><a href="score_rule.html?text=score_rule">积分现金管理</a></li>
	                <li><a href="user_management.html?text=user_management">报表管理</a></li>
	                <li><a href="institution_management.html?text=institution_management">系统管理</a></li>
	            </ul>
            </div>
            <!--logo-->

            <!--右侧管理员登录-->
            <div class="navbar-buttons navbar-header pull-right" role="navigation">
                <ul class="nav ace-nav">
                    <li class="light-blue dropdown-modal">
                        <a data-toggle="dropdown" href="#" class="dropdown-toggle" style="background: #fbfbfb">
                    <!--         <img id="user_avatar" class="nav-user-photo" src="static/img/favicon.png" alt="Jason's Photo" /> -->
                            <span id="username" class="user-info">
                                
                            </span>

                            <i class="ace-icon fa fa-caret-down"></i>
                        </a>

                        <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                            <!--<li>
								<a href="#">
									<i class="ace-icon fa fa-user"></i>
									修改密码
								</a>
							</li>-->

                            <!--<li class="divider"></li>-->
                            <li id="sigin_out">
                                <a href="#">
                                    <i class="ace-icon fa fa-power-off"></i>
                                    注销用户
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!--右侧管理员登录-->
        </div>
        <!-- /.navbar-container -->
    </div>
    <!--顶部logo、user信息-->

    <!--内容区-->
    <div class="main-container ace-save-state" id="main-container">
        <script type="text/javascript">
            try {
                ace.settings.loadState('main-container')
            } catch (e) {}
        </script>

        <!--左侧导航-->
        <div id="sidebar" class="sidebar responsive ace-save-state JS-nav">
            <script type="text/javascript">
                try {
                    ace.settings.loadState('sidebar')
                } catch (e) {}
            </script>

            <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
                <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state" data-icon1="ace-icon fa fa-angle-double-left"
                    data-icon2="ace-icon fa fa-angle-double-right"></i>
            </div>
        </div>
        <!--左侧导航-->

        <!--右侧内容区-->
        <div class="main-content">
            <div class="main-content-inner">
				<div class="breadcrumbs ace-save-state" id="breadcrumbs">
	                <!-- 面包屑导航 -->
	                <ul class="breadcrumb">
	                    <li>小区列表</li>
	                </ul>
	            </div>
                <div class="page-content style_adjustment">
					<div class="row style_adjustment">
						<!--条件查询-->
                        <div class="order-box">
                            <form class="form-inline">
                                <div class="clearfix row">
                                    <div class="pull-left col-xs-12 col-sm-3">
                                        <label>机构：</label>
                                        <select id="institution" class="form-control search-input w-150 institution_list">
                                <!--             <option value="0">全部机构</option>
                                            <option value="1">xxx机构</option> -->
                                        </select>
                                    </div>
                                    <div class="pull-left col-xs-12 col-sm-3">
                                        <label>小区名称：</label>
                                        <input placeholder="请输入小区名称" type="text" class="form-control w-150 search-input" id="name">
                                    </div>
                                    <div class="pull-left col-xs-12 col-sm-3">
                                        
                                    </div>
                                </div>
                                <div class="clearfix row" style="margin-top: 10px">
									<div class="pull-left col-xs-12  col-sm-3">
                                        <label>
                                            省：
                                        </label>
                                        <select id="province" class="form-control search-input w-150">
                                            
                                        </select>
                                    </div>
									<div class="pull-left col-xs-3 col-sm-3">
                                        <label>
                                            市：
                                        </label>
                                        <select class="form-control search-input w-150" id="city">
                                            <option value="">请选择</option>
                                        </select>
                                    </div>
									 <div class="pull-left col-xs-12  col-sm-3">
                                        <label>
                                            县：
                                        </label>
                                        <select class="form-control search-input w-150" id="county">
                                            <option value="">请选择</option>
                                        </select>
                                    </div>
                                    <div class="pull-right">
										<button id="search" type="button" class="btn btn-success btn-xs" style="margin-right: 5px">
											<i class="ace-icon fa fa-search bigger-110"></i>
											搜索
										</button>
									</div>
                                </div>
                                <div class="clearfix row" style="margin-top:20px;margin-left:10px;">
									<a href="javascript:;" class="btn btn-xs btn-primary" data-toggle="modal" data-target="#createAreaModal">
										<i class="ace-icon fa fa-plus bigger-110"></i>
										新建小区
									</a>
                                </div>
                            </form>

                        </div>
                        <!--条件查询结束-->
						<!-- 表格 -->
						<div class="table-box table-box-sm">
							<table id="table" class="table table-bordered table-hover">
								<thead>
									<tr>
										<th class="center" width="60">序号</th>
										<th class="center" width="300">所属机构</th>
										<th class="center" width="300">小区名称</th>
										<th class="center" width="180">地区</th>
										<th class="center" width="100">日垃圾量(T)</th>
										<th class="center" width="100">总户数</th>
										<th class="center" width="100">总人数(人)</th>
										<th class="center" width="100">发桶数量</th>
										<th class="center" width="60">状态</th>
										<th class="center" width="300">操作</th>
									</tr>
								</thead>
								<tbody id="s_list">

								</tbody>
							</table>
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
					<!--分页开始-->
					<div class="row" id="page_conten" code="1">
						<ul class="pagination pull-right">
							<li _class="disabled" id="prev">
								<a href="javascript:;">
									<i class="ace-icon fa fa-angle-double-left"></i>
								</a>
							</li>
							<div id="page">
								
							</div>
							<li id="next">
								<a href="javascript:;">
									<i class="ace-icon fa fa-angle-double-right"></i>
								</a>
							</li>
							<li>
								<input class="gonumber" placeholder="跳转" style="padding-left: 10px;width:60px;height:32px;margin-left: 10px;" type="number" name="" id="" value="" />
								<button id="go">go</button>
							</li>
						</ul>
					</div>
					<!--分页结束-->
				</div>
				<!-- /.page-content -->
            </div>
        </div>
        <!--右侧内容区-->

        <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
            <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
        </a>
    </div>

    <div id="loading" style="width: 100%; height: 100%; background: rgba(0,0,0, .6); position: fixed; top: 0; left: 0; z-index: 999;">
	    <i class="ace-icon fa fa-spinner fa-spin orange bigger-125" style="position: absolute; top: 300px; font-size: 100px !important; width: 100%;"></i>
	</div>

	<!-- 创建小区 -->
    <div class="modal fade bs-example-modal-lg" id="createAreaModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">新建小区</h4>
	      </div>
	      <div class="modal-body">
	        <form class="form-horizontal">
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*所属机构:</label>
					<div class="col-sm-10">
			            <select class="form-control institution_list" id="add_institution">
							
			            </select>
			        </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*小区名称:</label>
					<div class="col-sm-10">
		            	<input type="text" class="form-control" id="add_name" />
		            </div>
	          </div>
	          <div class="form-group">
					<label for="inputEmail3" class="col-sm-2 control-label">*日垃圾量(吨):</label>
				    <div class="col-sm-10">
				      <input type="text" class="form-control" placeholder="" id="add_waste_num">
				    </div>
	          </div>
	          <div class="form-group">
						<label for="inputEmail3" class="col-sm-2 control-label">*总户数(户):</label>
					    <div class="col-sm-10">
					      <input type="text" class="form-control inline w-180" placeholder="" id="add_house_num">
						  <label for="inputEmail3" class="control-label inline">*总人数(人):</label>
					      <input type="text" class="form-control inline w-180" placeholder="" id="add_people_num">
					    </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">发桶数量:</label>
					<div class="col-sm-10">
		            	<input type="text" class="form-control" id="add_transh_num" />
		            </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*小区位置:</label>
					<div class="col-sm-10">
		            	<input type="text" class="form-control inline w-180" placeholder="地理经度" id="add_lng" />
		            	<input type="text" class="form-control inline w-180" placeholder="地理纬度" id="add_lat" />
						<button class='btn btn-xs btn-info' type="button" id="add_select_location">
							选择坐标
						</button>
		            </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*地区:</label>
					<div class="col-sm-10">
		            	<select class="form-control w-150 inline" id="add_province">
							<option value="0">请选择</option>
			            </select>
		            	<select class="form-control w-150 inline" id="add_city">
							<option value="0">请选择</option>
			            </select>
		            	<select class="form-control w-150 inline" id="add_county">
							<option value="0">请选择</option>
			            </select>
		            </div>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
	        <button type="button" class="btn btn-primary" id="add_save_btn">保存</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- 编辑小区 -->
    <div class="modal fade bs-example-modal-lg" id="editAreaModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
	  <div class="modal-dialog modal-lg" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="exampleModalLabel">编辑小区</h4>
	      </div>
	      <div class="modal-body">
	        <form class="form-horizontal">
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*所属机构:</label>
					<div class="col-sm-10">
			            <select class="form-control institution_list" id="edit_institution">
							
			            </select>
			        </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*小区名称:</label>
					<div class="col-sm-10">
		            	<input type="text" class="form-control" id="edit_name" />
		            </div>
	          </div>
	          <div class="form-group">
					<label for="inputEmail3" class="col-sm-2 control-label">*日垃圾量(吨):</label>
				    <div class="col-sm-10">
				      <input type="text" class="form-control" placeholder="" id="edit_waste_num">
				    </div>
	          </div>
	          <div class="form-group">
						<label for="inputEmail3" class="col-sm-2 control-label">*总户数(户):</label>
					    <div class="col-sm-10">
					      <input type="text" class="form-control inline w-180" placeholder="" id="edit_house_num" />
						  <label for="inputEmail3" class="control-label inline">*总人数(人):</label>
					      <input type="text" class="form-control inline w-180" placeholder="" id="edit_people_num" />
					    </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">发桶数量:</label>
					<div class="col-sm-10">
		            	<input type="text" class="form-control" id="edit_transh_num" />
		            </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*小区位置:</label>
					<div class="col-sm-10">
		            	<input type="text" class="form-control inline w-180" placeholder="地理经度" id="edit_lng" />
		            	<input type="text" class="form-control inline w-180" placeholder="地理纬度" id="edit_lat" />
						<button class='btn btn-xs btn-info' type="button" id="edit_select_location">
							选择坐标
						</button>
		            </div>
	          </div>
	          <div class="form-group">
					<label for="recipient-name" class="col-sm-2 control-label">*地区:</label>
					<div class="col-sm-10">
		            	<select class="form-control w-150 inline" id="edit_province">
							
			            </select>
		            	<select class="form-control w-150 inline" id="edit_city">
							
			            </select>
		            	<select class="form-control w-150 inline" id="edit_county">
							
			            </select>
		            </div>
	          </div>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
	        <button type="button" class="btn btn-primary" id="edit_save_btn">保存</button>
	      </div>
	    </div>
	  </div>
	</div>

	<!-- 调用地图选择坐标 -->
	<div class="modal fade bs-example-modal-lg" id="selectLocationModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
	  <div class="modal-dialog modal-lg" role="document" style="width:90%;">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title">请选择地点</h4>
	      </div>
	      <div class="modal-body">
	      	<div class="map_container">

				<iframe src="map.html" id="map_container" width="100%" height="500"></iframe>

			</div>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
	        <button type="button" class="btn btn-primary" id="map_save_btn">保存</button>
	      </div>
	    </div>
	  </div>
	</div>

    <!-- basic scripts -->
    <!--[if !IE]> -->
    <script src="assets/js/jquery-2.1.4.min.js"></script>
    <!-- <![endif]-->

    <!--[if IE]>
	<script src="assets/js/jquery-1.11.3.min.js"></script>
	<![endif]-->
    <script type="text/javascript">
        if ('ontouchstart' in document.documentElement) document.write(
            "<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!-- page specific plugin scripts -->

    <!--[if lte IE 8]>
		  <script src="assets/js/excanvas.min.js"></script>
		<![endif]-->
    <script src="assets/js/jquery-ui.custom.min.js"></script>
    <script src="assets/js/jquery.ui.touch-punch.min.js"></script>
    <script src="assets/js/jquery.easypiechart.min.js"></script>
    <script src="assets/js/jquery.sparkline.index.min.js"></script>
    <script src="assets/js/jquery.flot.min.js"></script>
    <script src="assets/js/jquery.flot.pie.min.js"></script>
    <script src="assets/js/jquery.flot.resize.min.js"></script>
	<script src="assets/js/bootbox.js" type="text/javascript" charset="utf-8"></script>

    <!-- ace scripts -->
    <script src="assets/js/ace-elements.min.js"></script>
    <script src="assets/js/ace.min.js"></script>

    <!-- inline scripts related to this page -->
    <script src="static/js/toast/toast.js"></script>
    <script src="static/js/md5.js"></script>
    <script src="static/js/utils.js"></script>
    <script src="static/js/cookies.js"></script>
    <script src="static/js/nav.js"></script>
    <script type="text/javascript">
        $(function(){
		//请求开关
		var bOK = true;
		//新建或者编辑选择坐标标识 add 新建 edit 编辑
		var mapFlag = 'add';
        var page;
        var cade;
    	//搜索条件
    	var searchObj = {
    		name:'',
    		mechanism_id:'',
    		province_id:'',
    		city_id:'',
    		county_id:'',
    		page: cade
    	}
    	var pageFn = {
    		init: function(){
    			$('#username').text(getCookie('username'));
    			pageFn.createNav();
    			pageFn.getList(searchObj);
				//分页
                pageFn.pageList(page,cade);
                //获取省
                pageFn.getProvince();
    			pageFn.search();
    			//初始化新建小区保存按钮
    			pageFn.addSaveFn();
    			//初始化编辑小区保存按钮
    			pageFn.editSaveFn();
    			//获取机构列表
    			pageFn.getInstitutionList();
    			//冻结/解冻小区
    			pageFn.frozenFn();
    			//退出登录
    			pageFn.logOut();
    			//地图选择坐标
    			pageFn.selectLocation();
    		},
    		getList: function(searchObj){
    			request({
					url: '/api/houses/getList',
					data: searchObj
				}, function(data) {
					console.log(data)
					if(!bOK){
						$('#loading').show();
					}
					if(data.code == 0){
						var res = data.data.list;
						//创建列表
						var shtml = '';

						if(res.length > 0){
                            cade = data.data.current_page;
                            page = Math.ceil(data.data.total/20);
                            pageFn.pageList(page,cade);

							$.each(res, function(index, item){
								shtml += pageFn.createList(item,index);
							})

							$("#page_conten").show();
							//点击分页
                        	pageFn.pageClick();
                        }else{
							shtml += '<tr><td colspan="'+ $("#table tr th").length +'">暂无数据。</td></tr>';
							$("#page_conten").hide();
                        }

						setTimeout(function(){
							$('#s_list').html(shtml);
							bOK = true;
							$('#loading').hide();
						}, 1000)
					}else{
						toast(data.msg).then(function(){
							$('#loading').hide();
						});
					}
				})
    		},
    		createNav: function () {
                var nav_container = $(".JS-nav")[0];
                this.nav = new Nav(nav_container);
            },
    		//地图选择坐标
            selectLocation: function(){
            	//新建选择坐标
            	$('#add_select_location').click(function(){
    				$('#selectLocationModal').modal('show');
    				mapFlag = 'add';
    			})

            	//编辑选择坐标
    			$('#edit_select_location').click(function(){
    				$('#selectLocationModal').modal('show');
    				mapFlag = 'edit';
    			})

    			$('#map_save_btn').click(function(){
    				var location = $("#map_container").contents().find("#poi_cur").val();
    				var arr = location.split(',');
    				if(mapFlag == 'add'){
						$('#add_lng').val(arr[1]);
						$('#add_lat').val(arr[0]);
    				}else if(mapFlag == 'edit'){
    					$('#edit_lng').val(arr[1]);
						$('#edit_lat').val(arr[0]);
    				}
    				$('#selectLocationModal').modal('hide');
    			})
            },
            getProvince: function(){
            	request({
					url: '/api/houses/getProvince',
					data: {}
				}, function(res) {
					if(res.code == 0){
						var shtml = '<option value="">请选择</option>';
						$.each(res.data, function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$('#province').html(shtml);
						$('#add_province,#edit_province').html(shtml);

						$('#province').change(function(){
							var pid = $(this).val();
							$('#city').html('<option value="">请选择</option>');
							$('#county').html('<option value="">请选择</option>');
							pageFn.getCity(pid);
						})

						$('#add_province').change(function(){
							var pid = $(this).val();
							$('#add_city').html('<option value="">请选择</option>');
							$('#add_county').html('<option value="">请选择</option>');
							pageFn.getCityAdd(pid);
						})

						$('#edit_province').change(function(){
							var pid = $(this).val();
							$('#edit_city').html('<option value="">请选择</option>');
							$('#edit_county').html('<option value="">请选择</option>');
							pageFn.getCityEdit(pid);
						})
					}else{
						toast(res.msg);
					}
				})
            },
            getCity: function(pid){
            	if(!pid) return;
            	request({
					url: '/api/houses/getCity',
					data: {
						pid: pid
					}
				}, function(res) {
					if(res.code == 0){
						var shtml = '<option value="">请选择</option>';
						$.each(res.data, function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$('#city').html(shtml);

						$('#city').change(function(){
							var cid = $(this).val();
							pageFn.getCounty(cid);
						})
					}else{
						toast(res.msg);
					}
				})
            },
            //新建小区获取城市
            getCityAdd: function(pid){
            	if(!pid) return;
            	request({
					url: '/api/houses/getCity',
					data: {
						pid: pid
					}
				}, function(res) {
					if(res.code == 0){
						var shtml = '<option value="">请选择</option>';
						$.each(res.data, function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$('#add_city').html(shtml);

						$('#add_city').change(function(){
							var cid = $(this).val();
							pageFn.getCountyAdd(cid);
						})
					}else{
						toast(res.msg);
					}
				})
            },
            //编辑小区获取城市
            getCityEdit: function(pid){
            	if(!pid) return;
            	request({
					url: '/api/houses/getCity',
					data: {
						pid: pid
					}
				}, function(res) {
					if(res.code == 0){
						var shtml = '<option value="">请选择</option>';
						$.each(res.data, function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$('#edit_city').html(shtml);

						$('#edit_city').change(function(){
							var cid = $(this).val();
							pageFn.getCountyEdit(cid);
						})
					}else{
						toast(res.msg);
					}
				})
            },
            getCounty: function(cid){
            	if(!cid) return;
            	request({
					url: '/api/houses/getCounty',
					data: {
						cid: cid
					}
				}, function(res) {
					if(res.code == 0){
						var shtml = '<option value="">请选择</option>';
						$.each(res.data, function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$('#county').html(shtml);
					}else{
						toast(res.msg);
					}
				})
            },
            //新建小区获取区县
            getCountyAdd: function(cid){
            	if(!cid) return;
            	request({
					url: '/api/houses/getCounty',
					data: {
						cid: cid
					}
				}, function(res) {
					if(res.code == 0){
						var shtml = '<option value="">请选择</option>';
						$.each(res.data, function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$('#add_county').html(shtml);
					}else{
						toast(res.msg);
					}
				})
            },
            //编辑小区获取区县
            getCountyEdit: function(cid){
            	if(!cid) return;
            	request({
					url: '/api/houses/getCounty',
					data: {
						cid: cid
					}
				}, function(res) {
					if(res.code == 0){
						var shtml = '<option value="">请选择</option>';
						$.each(res.data, function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$('#edit_county').html(shtml);
					}else{
						toast(res.msg);
					}
				})
            },
            search: function(){
            	$('#search').click(function(){
            		var name = $('#name').val();
            		var mechanism_id = $('#institution').val();
            		var province_id = $('#province').val();
            		var city_id = $('#city').val();
            		var county_id = $('#county').val();

            		searchObj = {
			    		name:name,
			    		mechanism_id:mechanism_id,
			    		province_id:province_id,
			    		city_id:city_id,
			    		county_id:county_id,
			    		page: cade
			    	}

            		pageFn.getList(searchObj);
            	})
            },
    		//获取机构列表
            getInstitutionList: function(){
            	request({
					url: '/api/mechanism/getNoPageList',
					data: {}
				}, function(res) {
					console.log(res);
					if(res.code == 0){
						var list = res.data.list;

						var shtml = '<option value="">请选择</option>';
						var ahtml = '<option value="">请选择</option>';
						$.each(list,function(index,item){
							shtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
						})
						$.each(list,function(index,item){
							//if(item.status == 1){
								ahtml += '<option value="'+ item.id +'">'+ item.name +'</option>';
							//}
						})
						$('#institution').html(shtml);
						$('#add_institution,#edit_institution').html(ahtml);
					}else{
						toast(res.msg);
					}
				})
            },
            //新建小区保存按钮
            addSaveFn: function(){
            	$('#add_save_btn').click(function(){
            		var add_institution_id = $('#add_institution').val();
            		var add_name = $('#add_name').val();
            		var add_waste_num = $('#add_waste_num').val();
            		var add_house_num = $('#add_house_num').val();
            		var add_people_num = $('#add_people_num').val();
            		var add_transh_num = $('#add_transh_num').val();
            		var add_lng = $('#add_lng').val();
            		var add_lat = $('#add_lat').val();
            		var add_province_id = $('#add_province').val();
            		var add_city_id = $('#add_city').val();
            		var add_county_id = $('#add_county').val();

            		if(!add_institution) return toast('请选择所属机构');
            		if(!add_name) return toast('请填写小区名称');
            		if(!add_waste_num) return toast('请填写日垃圾量');
            		if(!add_house_num) return toast('请填写总户数');
            		if(!add_people_num) return toast('请填写总人数');
            		//if(!add_transh_num) return toast('请填写发桶数量');
            		if(!add_lng || !add_lat) return toast('请选择坐标');
            		if(!add_province_id) return toast('请选择省');
            		if(!add_city_id) return toast('请选择市');
            		if(!add_county_id) return toast('请选择区县');

            		var tempObj = {
            			name:add_name,
            			mechanism_id:add_institution_id,
            			province_id:add_province_id,
            			city_id:add_city_id,
            			county_id:add_county_id,
            			lng:add_lng,
            			lat:add_lat,
            			house_num:add_house_num,
            			people_num:add_people_num,
            			waste_num:add_waste_num,
            			transh_num:add_transh_num
            		}

            		request({
						url: '/api/houses/add',
						data: tempObj
					}, function(data) {
						console.log(data)
						if(data.code == 0){
							toast('添加成功！').then(function(){
								searchObj = {
						    		name:'',
						    		mechanism_id:'',
						    		province_id:'',
						    		city_id:'',
						    		county_id:'',
						    		page: 1
						    	}
    							pageFn.getList(searchObj);

            					$('#createAreaModal').modal('hide');
							})
						}else{
							toast(data.msg);
						}
					})

            	})
            },
            //冻结/解冻小区
            frozenFn: function(){
            	$('#s_list').on('click','.frozen', function(){
            		var _id = $(this).data().id;
            		var _status = $(this).data().status;
            		var tips = '';
            		if(_status == 1){
            			tips = '您确定要解冻吗？';
            		}else{
            			tips = '您确定要冻结吗？';
            		}

            		bootbox.dialog({ 
				        message: '<div style="height:30px;line-height:30px;font-size:16px;">'+ tips +'</div>',  
				        buttons: {  
				            Cancel: {
				                label: "取消",  
				                className: "btn-default",  
				                callback: function () {  
				
				                }  
				            },
				            OK: {  
				                label: "确定",  
				                className: "btn-primary",  
				                callback: function () {
									request({
										url: '/api/houses/frozen',
										data: {
											id:_id,
											status:(_status==0?1:0)
										}
									}, function(data) {
										console.log(data)
										if(data.code == 0){
											toast('操作成功').then(function(){
												searchObj = {
										    		name:'',
										    		mechanism_id:'',
										    		province_id:'',
										    		city_id:'',
										    		county_id:'',
										    		page: 1
										    	}
				    							pageFn.getList(searchObj);
											});
										}else{
											toast(data.msg);
										}
									})
				                }  
				            }  
				        }  
				    }); 
            		
            		
            	})
            },
            //编辑小区保存
            editSaveFn: function(){
            	var _id = null;
            	$('#s_list').on('click','.modify', function(){
            		$('#editAreaModal').modal('show');

            		_id = $(this).data().id;

            		request({
						url: '/api/houses/info',
						data: {
							id:_id,
							action:'edit'
						}
					}, function(data) {
						console.log(data)
						if(data.code == 0){
							var info = data.data.infodata[0];
							$('#edit_institution').val(info.mechanism_id);
							$('#edit_name').val(info.name);
							$('#edit_waste_num').val(info.waste_num);
							$('#edit_house_num').val(info.house_num);
							$('#edit_people_num').val(info.people_num);
							$('#edit_transh_num').val(info.transh_num);
							$('#edit_lng').val(info.lng);
							$('#edit_lat').val(info.lat);
							$('#edit_province').val(info.province_id);
							//获取城市数据
							pageFn.getCityEdit(info.province_id);
							//获取区县数据
							pageFn.getCountyEdit(info.city_id);
							setTimeout(function(){
								$('#edit_city').val(info.city_id);
								$('#edit_county').val(info.county_id);
							},300)
						}else{
							toast(data.msg);
						}
					})

            	})

            	//保存按钮
            	$('#edit_save_btn').click(function(){
            		var edit_institution_id = $('#edit_institution').val();
            		var edit_name = $('#edit_name').val();
            		var edit_waste_num = $('#edit_waste_num').val();
            		var edit_house_num = $('#edit_house_num').val();
            		var edit_people_num = $('#edit_people_num').val();
            		var edit_transh_num = $('#edit_transh_num').val();
            		var edit_lng = $('#edit_lng').val();
            		var edit_lat = $('#edit_lat').val();
            		var edit_province_id = $('#edit_province').val();
            		var edit_city_id = $('#edit_city').val();
            		var edit_county_id = $('#edit_county').val();

            		if(!edit_institution) return toast('请选择所属机构');
            		if(!edit_name) return toast('请填写小区名称');
            		if(!edit_waste_num) return toast('请填写日垃圾量');
            		if(!edit_house_num) return toast('请填写总户数');
            		if(!edit_people_num) return toast('请填写总人数');
            		if(!edit_transh_num) return toast('请填写发桶数量');
            		if(!edit_lng || !edit_lat) return toast('请选择坐标');
            		if(!edit_province_id) return toast('请选择省');
            		if(!edit_city_id) return toast('请选择市');
            		if(!edit_county_id) return toast('请选择区县');

            		var tempObj = {
            			id:_id,
            			name:edit_name,
            			mechanism_id:edit_institution_id,
            			province_id:edit_province_id,
            			city_id:edit_city_id,
            			county_id:edit_county_id,
            			lng:edit_lng,
            			lat:edit_lat,
            			house_num:edit_house_num,
            			people_num:edit_people_num,
            			waste_num:edit_waste_num,
            			transh_num:edit_transh_num
            		}

            		request({
						url: '/api/houses/edit',
						data: tempObj
					}, function(data) {
						console.log(data)
						if(data.code == 0){
							toast('修改成功！').then(function(){
								searchObj = {
						    		name:'',
						    		mechanism_id:'',
						    		province_id:'',
						    		city_id:'',
						    		county_id:'',
						    		page: 1
						    	}
    							pageFn.getList(searchObj);

            					$('#editAreaModal').modal('hide');
							})
						}else{
							toast(data.msg);
						}
					})
            	})
            },
            //创建dom
			createList: function(item,index){
				var shtml = '';
				var _index = (cade-1)*20 + (index+1);

				shtml += '<tr>';
				shtml += '										<td class="center">'+ _index +'</td>';
				shtml += '										<td class="center">'+ item.m_name +'</td>';
				shtml += '										<td class="center">'+ item.name +'</td>';
				shtml += '										<td class="center">'+ (item.province_name + item.city_name + item.county_name) +'</td>';
				shtml += '										<td class="center">'+ item.waste_num +'</td>';
				shtml += '										<td class="center">'+ item.house_num +'</td>';
				shtml += '										<td class="center">'+ item.people_num +'</td>';
				shtml += '										<td class="center">'+ item.transh_num +'</td>';
				shtml += '										<td class="center">'+ (item.status == 0?'解冻':'冻结') +'</td>';
				shtml += '										<td class="center">';
				shtml += '											<button class=\'modify btn btn-xs btn-info\' data-id="'+ item.id +'">';
				shtml += '												<i class="ace-icon fa fa-pencil bigger-120"></i>';
				shtml += '												编辑';
				shtml += '											</button>';
				shtml += '											<button class=\'frozen btn btn-xs btn-info\' data-id="'+ item.id +'" data-status="'+ item.status +'">';
				shtml += '												<i class="ace-icon fa '+ (item.status == 0?'fa-lock':'fa-unlock') +' bigger-150"></i>'+ (item.status == 1?'解冻':'冻结');
				shtml += '											</button>';
				shtml += '											<a class=\'enter btn btn-xs btn-info\' href="area_detail.html?text=area_list&id='+ item.id +'">';
				shtml += '												进入小区';
				shtml += '											</a>';
				shtml += '										</td>';
				shtml += '									</tr>';

				return shtml;
			},
			//获取页码
            pageList:function(page,cade){
                var scade = cade-3;
                if(scade<0){
                    scade=0;
                }
                var spage = page-5;
                var page_cade = page -cade;
                var shtml = '';
                if(page_cade<5){
                    if(page>5){
                        page = 5;
                    }else{
                        spage = 0;
                    }
                    for(var i = 0;i<page;i++){
                        spage = spage+1;
                        shtml += '<li>';
                        shtml += '	<a name="'+spage+'" href="javascript:;">'+spage+'</a>';
                        shtml += '</li>';
                    }
                }else{
                    var pageend = page-1
                    for(var i = 0;i<3;i++){
                        scade = scade+1;
                        shtml += '<li>';
                        shtml += '	<a name="'+scade+'" href="javascript:;">'+scade+'</a>';
                        shtml += '</li>';
                    }
                    shtml += '<li>';
                    shtml += '	<i class="pagedian" href="#">....</i>';
                    shtml += '</li>';
                    shtml += '<li>';
                    shtml += '	<a name="'+pageend+'" href="javascript:;">'+pageend+'</a>';
                    shtml += '</li>';
                    shtml += '<li>';
                    shtml += '	<a name="'+page+'" href="javascript:;">'+page+'</a>';
                    shtml += '</li>';
                }
                $("#page").html(shtml);
                $("#page_conten").attr("code",cade);
                $("#page li a").removeClass("redapge");
                for(var i = 0;i<$("#page li a").length;i++){
                    var id = $("#page li a").eq(i).html();
                    if(id == cade){
                        $("#page li a").eq(i).addClass("redapge");
                    }
                }
            },
            //点击页码
            pageClick:function(){
                $("#page").off().on("click","li",function(){
                    var _this = $(this).children("a");
                    cade = _this.html();
                    $("#page_conten").attr("code",cade);
                    searchObj.page = cade;
                    pageFn.getList(searchObj);
                })
                $("#prev").off().on("click",function(){
                    cade = $("#page_conten").attr("code")-1;
                    if(cade>0){
                        searchObj.page =cade;
                        pageFn.getList(searchObj);
                    }
                })
                $("#next").off().on("click",function(){
                    cade = parseInt($("#page_conten").attr("code"))+1;
                    console.log(cade);
                    if(cade<=page){
                        searchObj.page =cade;
                        pageFn.getList(searchObj);
                    }
                })
                $("#go").off().on("click",function(){
                    cade = $(".gonumber").val();
                    if(cade<=page){
                        searchObj.page =cade;
                        pageFn.getList(searchObj);
                    }
                })
            },
            logOut: function(){
            	$('#sigin_out').click(function(){
            		request({
						url: '/api/user/log-off',
						data: {}
					}, function(res) {
						deleteCookie('token');
						toast('注销成功').then(function(){
							location.href = 'login.html';
						})
					})
            	})
            }
    	}

    	pageFn.init();

    })
    </script>
</body>

</html>